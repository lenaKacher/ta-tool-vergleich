name: CI Workflow

on:
  workflow_dispatch:
    inputs:
      RUN_SELENIUM_JAVA:
        type: boolean
        default: false
      RUN_SELENIUM_POP:
        type: boolean
        default: false
      RUN_SELENIUM_JS:
        type: boolean
        default: false
      RUN_PLAYWRIGHT_JAVA:
        type: boolean
        default: false
      RUN_PLAYWRIGHT_JS:
        type: boolean
        default: false
      RUN_CYPRESS_JS:
        type: boolean
        default: false
      NUMBER_OF_RUNS:
        type: string
        default: '2'

jobs:
  playwright:
    runs-on: self-hosted
    if: inputs.RUN_PLAYWRIGHT_JAVA || inputs.RUN_PLAYWRIGHT_JS
    services:
      docker:
        image: docker:dind
        options: --privileged --shm-size=2g
        volumes:
          - /var/run/docker.sock:/var/run/docker.sock:ro
    container:
      image: ubuntu:latest
    
    steps:
      - name: Install system dependencies 
        run: |
          apt-get update && apt-get install -y curl
          curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
          apt-get install -y nodejs
        shell: bash

      - name: Checkout code
        uses: actions/checkout@v3

      - name: Run Playwright JavaScript
        if: inputs.RUN_PLAYWRIGHT_JS
        run: |
          cd playwright/js
          npm ci
          npx playwright install
          npx playwright install-deps
          npm run test
          cp timings.csv playwright-java.csv

      - name: Debug timings.csv and playwright-java.csv
        run: |
          cd playwright/js
          ls -la
   
      - name: Copy timings.csv to playwright-java.csv
        uses: actions/upload-artifact@v3
        with:
          name: playwright-java.csv
          path: playwright/js/playwright-java.csv
          if-no-files-found: ignore
